## 📕 Day 11 - BoostCamp

### 📘 BE - 데이터베이스 종류와 활용 (강의)

### 📘 현업의 이야기

소프트웨어 원칙 : 남이 만든걸 사용하면 좋습니다.

유명한 유료 솔루션 사용하는게 좋습니다.

### 📘 데이터베이스

ex) txt, csv, sql

처음엔 내용을 기준으로 데이터를 검색해야 한다고 주장했습니다.

데이터를 보존하기 위해서 비휘발성 저장소에 저장하는 것을 영속화라고 합니다.

데이터 저장소로는 영속화되는 데이터를 저장하는 관계형 데이터베이스를 보편적으로 사용한다.

문제는 OOP(객체 모델l)와 관계형 데이터베이스(관계 모델)는 같은 데이터를 표현하고 다루는 방법이 차이가 발생한다는 것이다.

이를 패러다임의 불일치 또는 Object-relational impedance mismatch 라고도 한다.

이를 해결하기 위해 하이브리드 객체 관계 데이터베이스의 개발입니다.

데이터 : 바이너리? 0과 1로 저장할 수 있는 전기적인 신호로 저장된 정보

우리가 쓰는 모든 것들은 dbms입니다. ex) mongodb, mysql

* DIKW 피라미드

![image](https://user-images.githubusercontent.com/42922298/132190114-e94e13ec-aada-48fb-a50c-58c4cf908e69.png)

Data : 가공 전의 수치나 자료

Information : 의미가 있는 데이터

knowledge : 쓸모있는 정보가 있어 부가가치를 발생하는 활동(예측)

Insight : 그 상황을 보는 행위, the power or act of seeing into a situation

wisdom : 앞으로 어떤 일이 일어날지 알아 발전 시키는 창의적인 아이디어(예측), a wise attitude, belief, or course of action.

* 📃 Memo

RDMS : 관계를 이용해서 저장합니다.

PostgreSQL == Post Ingres

DB2 cobol

db-engines ranking

sql == 씨퀄 (sql이 표준)

srm : 고객관리 SAP HANA

### 📘 행 / 열 기반 데이터베이스

#### 📘 행 기반

행 기반으로 저장하는 것은 Row store

레코드 단위 기반의 저장 방식을 취합니다.

기간계 시스템이라고 부르는 OLTP 환경(Insert, Update, Delete 작업이 매우 빈번히 발생)에서는 행 기반이 좋습니다.

#### 📘 열 기반

열 기반으로 저장하는 것은 column store

열 단위 기반의 저장 방식을 취합니다.

분석계 시스템이라고 부르는 OLAP 환경(거의 Select 작업만 발생)에서는 열 기반을 사용하는 것이 좋습니다.

ex) Amazon Redshift / Google BigQuery

> 행 기반 방식과 열 기반 방식의 차이점은 정규화

### 📘 SQL의 특징

> sql 쿼리 공부해라

C언어가 절차적 언어인거와 달리 SQL은 선언적 언어(=무엇을 할 것인지에 중점)에 중점을 두고 있습니다.

어떤 방법으로 자료를 찾아야 하는지가 주어지지 않고 대신에 원하는 자료의 기준만 주어지기 때문이다.

### 📘 관계형 데이터베이스

관계형 데이터베이스의 특징 : 트렌젝션 , 분산, 확장이 힘듭니다.

관계형 데이터베이스를 많이 쓰는 이유 : 익숙해서

oracle : 은행, 학교, 정부 (로비해서)

트랜잭션 지원합니다.

#### 📘 트랜잭션(Transaction)

* 데이터베이스 내에서 하나의 그룹으로 처리되어야 하는 명령문들을 모아 놓은 논리적인 작업 단위

1. 데이터베이스 응용 프로그램은 트랜잭션들의 집합으로 정의 할 수 있다.

2. 여러 단계의 처리를 하나의 처리처럼 다루는 기능이다.

3. 여러 개의 명령어의 집합이 정상적으로 처리되면 정상 종료된다.

4. 하나의 명령어라도 잘못되면 전체 취소된다.

* 트랜잭션을 쓰는 이유는 데이터의 일관성을 유지하면서 안정적으로 데이터를 복구하기 위해서입니다.

### 📘 분산 서버의 특징

#### 📘 CAP

Consistency : 다른 서버에서도 가장 최근에 쓰여진 데이터가 읽혀야 됨

Availability : 보낸 요청에 대해서는 응답을 줄 수 있어야 됨 (가용성)

시스템이 “가장 최근의 데이터만을 줘야된다” 라는 제약이 붙게 되면, 가장 최근인지 아닌지 판단을 할 수 없는 경우 응답을 보내지 못할 수도 있게 된다는 점이 존재합니다.

Partition Tolerence : 서버간의 통신에서 설령 네트워크가 끊긴 수준의 오류가 있더라도 시스템이 동작해야 됨을 의미합니다.

Partition tolerance 한 시스템을 구현하기 위해서는 Consistency 나 Availability 둘 다를 얻을 수 없음을 의미합니다.

실제 consistency를 가끔 포기합니다. 대신 eventually consistency를 보장해줍니다.

Eventual consistency는 항목이 새롭게 업데이트되지 않는다는 전제하에 항목의 모든 읽기 작업이 최종적으로는 마지막으로 업데이트된 값을 반환한다는 것을 이론적으로 보장합니다.

Ex) DNS 서버  |  strong consistency와 반대되는 개념

참고 사이트 : https://cloud.google.com/datastore/docs/articles/balancing-strong-and-eventual-consistency-with-google-cloud-datastore?hl=ko

#### 📘 ACID

RDBMS 는 Relational Database Management System, 보통 RDB 라는 이름으로 부르기도 합니다.

전통적인 RDB 에서는 Network Partition 을 크게 고려하지 않았다. 

DB는 같은 데이터센터 안에, 심지어 같은 랙에 존재하고 있고 그 때문에 서버간 통신은 굉장히 잘 관리가 되는 안정적인 상황이었기 때문이다.

Atomicity : 관련된 작업들은 전부 반영되거나 아니면 하나도 반영이 안되거나 해야된다는 것을 의미한다. 

“All or nothing” 인데, 쉽게 생각해서 우리가 SQL 에 transaction 을 만들면 그 안의 작업들이 모두 다같이 반영되어야 되는 것을 예로 들 수 있습니다.

Consistency : DB 의 상태가 늘 일관된 상태를 유지해야됨을 의미한다. 

예를 들어 DB 데이터의 속성이나 테이블 내 제약 등이 지정되어있는 경우 이를 준수하는 상황이 계속 일관되게 이어져야 된다는 것

Isolation : 여러 작업이 실행되더라도 그것이 순차적으로 실행된 것과 같은 결과를 내야됨을 의미한다.

만일 두 작업이 겹치는 것이 아예 없다면 이는 전혀 상관없이 동시에 실행될 수 있어야 되고, 만일 겹치는 부분이 있으면 순서대로 처리가 되어야지 겹쳐서 처리되어 데이터가 이상한 상태가 되어서는 안된다는 것을 의미합니다.

Durability : 일단 작업이 완료 되었다고 리포팅이 되었다면 그게 DB 에 영구적으로 반영이 되어야 함을 의미합니다. 설령 DB 가 크래쉬 하더라도 말이다.

#### 📘 확장성

수직 확장 : 하드웨어 용량 (예 : CPU, RAM)을 늘려 서버의 처리 능력을 향상시키는 프로세스

수평 확장 : 서버 수를 늘려 확장성을 달성합니다. 이론적으로는 원하는만큼 서버를 병렬로 확장 할 수 있습니다.

하지만 분산 시스템의 문제도 상속받습니다.

동시 실행 : concurrency 에 대한 이슈 Ex) 분산된 서버가 동기화가 안되서 

##### 📘 해결법

* 샤딩

이름에서 알 수 있듯이 우리는 데이터베이스를 여러 조각 (샤드)으로 분할하고 있습니다. 각 샤드는 저장하는 데이터 유형에 해당하는 고유 인덱스를 가지고 있습니다. 예를 들어 데이터베이스를 이름으로 색인화하기로 선택한 경우 샤드 A는 이름이 A ~ F로 시작하는 사용자의 데이터를 저장할 수 있고, 샤드 B는 G ~ M 연령의 사용자 데이터를 저장할 수 있습니다. 검색 쿼리가 들어 오면 데이터베이스는 인덱스를 빠르게 참조하고 전체 데이터베이스를 스캔하는 대신 살펴 봐야 할 샤드를 빠르게 찾아 낼 수 있습니다.

그러나 특히 SQL 데이터베이스의 경우 데이터베이스 샤딩에는 비용이 발생한다는 점에 유의해야합니다. Oracle, MySQL, PostgreSQL과 같은 모 놀리 식 데이터베이스는 자동 샤딩을 지원하지 않으며 엔지니어는 샤딩을 처리하기 위해 논리를 수동으로 작성해야합니다. 유지 관리 비용이 높기 때문에 스키마 변경 (예 : 데이터베이스 분할 방법)이 어려워지는 경우가 많습니다.

* 클러스터 프록시

참고 사이트 : https://ichi.pro/ko/sql-mich-nosql-deiteobeiseuleul-hwagjanghaneun-bangbeob-18836422461151

### 📘 다양한 DB

elastic Search : full text 검색 엔진입니다. 로그 분석

ELK Stack(Elastic Stack) : "ELK"는 Elasticsearch, Logstash 및 Kibana, 이 오픈 소스 프로젝트 세 개의 머리글자입니다. Elasticsearch는 검색 및 분석 엔진입니다. Logstash는 여러 소스에서 동시에 데이터를 수집하여 변환한 후 Elasticsearch 같은 “stash”로 전송하는 서버 사이드 데이터 처리 파이프라인입니다. Kibana는 사용자가 Elasticsearch에서 차트와 그래프를 이용해 데이터를 시각화할 수 있게 해줍니다.

Elastic Stack은 ELK Stack이 그 다음 단계로 발전한 것입니다.

hadoop spark : 하둡은 분산 파일 시스템

google 빅파일 시스템 논문을 가지고 만들었다고 합니다. 

hadoop은 hadoop ecosystem을 가지고 있습니다.

Hadoop Components : 

맵리듀스는 여러 노드에 태스크를 분배하는 방법으로 각 노드 프로세스 데이터는 가능한 경우, 해당 노드에 저장됩니다. 맵리듀스 태스크는 맵(Map)과 리듀스(Reduce) 총 두단계로 구성됩니다. 간단한 예를 들면 fork-join의 개념을 들 수 있습니다. 큰 작업에 대해 fork로 분할하고 또다시 fork로 분할합니다. 작은 작업을 다시 join하게 됩니다. 하둡에서는 큰 데이터가 들어왔을 때 64MB단위 블럭으로 분할합니다. 각각 블럭에 대한 연산을 합니다.

Google Cloud Bigtable :

대규모 분석 및 운영 워크로드를 위한 확장 가능한 완전 관리형 NoSQL 데이터베이스 서비스로 최대 99.999%의 가용성을 제공합니다.

### 📘 SQL에 대해서 

외래키를 사용하면 외래키 무결성을 지킬 수 있지만 성능 저하가 생길 수 있습니다.

조인을 하면 성능 저하가 생길 수 있습니다.

데이터 무결성은 데이터의 정확도 또는 유효성을 의미합니다.

무결성과 성능은 서로 상충되는 관계입니다.

무결성 참고 사이트 : https://kosaf04pyh.tistory.com/202

* 무결성 제약조건의 주요 목적은 데이터베이스에 저장된 데이터의 무결성을 보장하고 데이터베이스의 상태를 일관되게 유지하는 것입니다.

### 🎞 Remark

서버 하나랑 db 같이 사용하기

포비 : 자바지기님

주석, console 사용하지 말기

돌아가는데,.... 쓸거 같은 코드도 남기지 말기

백엔드는 프로그래밍 언어, 프레임 워크, sql, http가 중요합니다.
