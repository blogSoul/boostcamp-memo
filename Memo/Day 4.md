## ğŸ“• Day 4 - BoostCamp

í•´ë‹¹ ê³¼ì œë¥¼ ë§Œë“¤ ë•Œ ë§Œë“  ë°©ì‹ :

ì¼ë‹¨ javascriptëŠ” ê°ì²´ì— ëŒ€í•œ ì£¼ì†Œë¥¼ ì•Œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

ê·¸ë¦¬ê³  í¬ì¸í„° ê°œë…ë„ ì—†ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì§ì ‘ ì£¼ì†Œë¥¼ ë§Œë“¤ì–´ ê°ì²´ë§ˆë‹¤ ì£¼ì†Œê°’ì„ ì¶”ê°€í•´ ì£¼ëŠ” ë°©ì‹ì„ íƒí–ˆìŠµë‹ˆë‹¤.

ê·¸ë¦¬ê³  4 ë°”ì´íŠ¸ ê¸°ì¤€ìœ¼ë¡œ ë©”ëª¨ë¦¬ êµ¬ì¡°ë¥¼ ì§œë¼ê³  ë˜ì–´ìˆì§€ë§Œ 4ë°”ì´íŠ¸ë¡œ ì§œë©´ intí˜•ì„ ì œì™¸í•œ ë‚˜ë¨¸ì§€ íƒ€ì…ì„ ì„ ì–¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

ê·¸ë¦¬ê³  javascriptëŠ” ë©”ëª¨ë¦¬ í• ë‹¹ì„ ì§ì ‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ê°ì²´ë¡œ ë©”ëª¨ë¦¬ í¬ê¸°ë¥¼ ì§€ì •í•´ì£¼ëŠ” ë°©ì‹ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

* stack ê°ì²´ 

```javascript
{
    type : type, // ì–´ë–¤ íƒ€ì…ìœ¼ë¡œ ì´ë£¨ì–´ì¡ŒëŠ”ì§€
    address : addressToHex(address), // í¬ì¸í„° ì£¼ì†Œê°€ ì–´ë–¤ì§€
    count : 4, // ì–¼ë§ˆë‚˜ í• ë‹¹ë˜ì–´ ìˆëŠ”ì§€ (í¬ì¸í„° í¬ê¸°ëŠ” 4ë¡œ ì§€ì •)
    name : ""
}
```

* heap ê°ì²´

```javascript
{
    type : type, // ì–´ë–¤ íƒ€ì…ìœ¼ë¡œ ì´ë£¨ì–´ì¡ŒëŠ”ì§€
    address : addressToHex(address), // í¬ì¸í„° ì£¼ì†Œê°€ ì–´ë–¤ì§€
    count : typeSize * count // ì–¼ë§ˆë‚˜ í• ë‹¹ë˜ì–´ ìˆëŠ”ì§€
}
```

stack ëª…ë ¹ì–´ëŠ” 8byteë¡œ ì„¤ì •

### ğŸ“˜ í”„ë¡œì„¸ìŠ¤ ë©”ëª¨ë¦¬ ëª¨ë¸

![20210723_020001](https://user-images.githubusercontent.com/42922298/126678901-e8f5fc82-6022-4268-9d3e-302006104ef5.png)

![20210723_015621](https://user-images.githubusercontent.com/42922298/126678898-2e24bcd2-bd43-43ef-b8e7-63342c47aff4.png)


Node.jsëŠ” V8 ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.

Heap ì˜ì—­ : ì°¸ì¡°í˜• ë°ì´í„°ì˜ ì‹¤ì²´(ë°°ì—´, ê°ì²´)ì™€ ë™ì  ë°ì´í„°(ë°°ì—´, ê°ì²´ì— ì‚¬ìš©ëœ ë¦¬í„°ëŸ´ ë°ì´í„°)ê°€ ì €ì¥ë˜ëŠ” ì˜ì—­

New ì˜ì—­ (Young Gen.) : ìµœê·¼ì— ë§Œë“¤ì–´ì§„ ë°ì´í„°ê°€ ì €ì¥ë˜ëŠ” ì¥ì†Œ

Old ì˜ì—­ (Old Gen.) : 2ë²ˆì˜ Minor GCì—ì„œ ì‚´ì•„ë‚¨ì€ ê°ì²´ë“¤ì€ Old ì˜ì—­ìœ¼ë¡œ ì´ë™
 
Stack ì˜ì—­ : Heapì— ìˆëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ì°¸ì¡°í•˜ëŠ” í¬ì¸í„°ì™€ í•¨ê»˜ ëª¨ë“œ value íƒ€ì…ì„ í¬í•¨ë˜ëŠ” ì¥ì†Œ

### ğŸ“˜ Process ê°ì²´ì— ê´€í•˜ì—¬

Process ê°ì²´ë¥¼ ì‚¬ìš©í•˜ë©´ ì‹¤ì œ í”„ë¡œì„¸ìŠ¤ ë©”ëª¨ë¦¬ê°€ ì–´ë–»ê²Œ ê´€ë¦¬ë˜ê³  ìˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì°¸ê³  : https://nodejs.org/api/process.html

### ğŸ“˜ í”„ë¡œì„¸ìŠ¤ ë©”ëª¨ë¦¬ ë™ì‘ ë°©ì‹

![7KpvEn1](https://user-images.githubusercontent.com/42922298/126677978-67a1aea1-695e-411b-8aa7-15b3ea9fbbab.gif)

ì´ì™€ ê°™ì´ stackì—ëŠ” ì£¼ì†Œê°€ heapì—ëŠ” ì‹¤ì œ ê°’ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.

### ğŸ“˜ javascript ë™ì‘ì›ë¦¬

V8 : êµ¬ê¸€ì´ ì£¼ë„í•˜ì—¬ C++ë¡œ ì‘ì„±ëœ ê³ ì„±ëŠ¥ì˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ & ì›¹ ì–´ì…ˆë¸”ë¦¬ ì–¸ì–´ì´ë‹¤. (ECMAScriptì™€ Web Assembly í‘œì¤€ì— ë§ê²Œ êµ¬í˜„)

![20210723_074406](https://user-images.githubusercontent.com/42922298/126718325-fcc3e751-906d-44f6-9deb-1223c5bdbb60.png)

1. javascript source codeë¥¼ ê°€ì ¸ì™€ Parserì—ê²Œ ë„˜ê¹€
   
2. ParserëŠ” parsingì„ í†µí•´ AST(Abstract Syntax Tree)ë¡œ ë³€í™˜
   
3. ASTë¥¼ interpreterë¥¼ í†µí•´ byte codeë¡œ ë³€í™˜ (=Ignition)
   
4. ê·¸ë¦¬ê³  bytecodeë¥¼ ì‹¤í–‰í•¨ìœ¼ë¡œì¨ ì‹¤ì œ ì‘ë™í•˜ê²Œ ëœë‹¤.
   
5. ê·¸ ì¤‘ ìì£¼ ì‚¬ìš©ë˜ëŠ” ì½”ë“œëŠ” TruboFanìœ¼ë¡œ ë³´ë‚´ì§„ë‹¤.
   
6. TruboFanì€ ì´ ì½”ë“œë¥¼ Optimized Machine Codeë¡œ compileí•œ í›„ ì‚¬ìš©.

### ğŸ“˜ NodeJS

nodejs ì–´í”Œë¦¬ì¼€ì´ì…˜ì€ long-running í”„ë¡œì„¸ìŠ¤ì…ë‹ˆë‹¤.

ì´ ì ì€ DB ì»¤ë„¥ì…˜ì„ í•œë²ˆ ì…‹ì—…í•˜ê³  ë‚˜ì„œ ëª¨ë“  requestë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ê³„ì† ì¬ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

V8ì€ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ native codeë¡œ ì»´íŒŒì¼í•´ì„œ ì‹¤í–‰í•©ë‹ˆë‹¤.

nodejsë‚´ í˜„ì¬ ë©”ëª¨ë¦¬ ì‚¬ìš©ì€ `process.memoryUsage()`ë¡œ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì°¸ê³  ë§í¬ : https://nodejs.org/api/process.html#process_process_memoryusage

ì´ í•¨ìˆ˜ëŠ” `Resident Set Size`, `Total Size of the Heap`, `Heap actually Used`ë¥¼ returní•©ë‹ˆë‹¤.

í™ ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ê³  í’€ì–´ì£¼ëŠ” ë©”ì¹´ë‹ˆì¦˜ì„ garbage collection ì´ë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.

`memory leak`ëŠ” ë©”ëª¨ë¦¬ê°€ ê³ ê°ˆë  ë•Œê¹Œì§€ í• ë‹¹ì„ ì§€ì†í•œë‹¤ë©´ í”„ë¡œê·¸ë¨ ì¶©ëŒì´ ë°œìƒí•  ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

node.jsì—ì„œëŠ” V8ì„ ì´ìš©í•´ì„œ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ native codeë¡œ ì»´íŒŒì¼í•©ë‹ˆë‹¤.

garbage collectionì˜ ì›€ì§ì„ì€ ê°„ë‹¨í•©ë‹ˆë‹¤.

ë§Œì•½ ë©”ëª¨ë¦¬ ì„¸ê·¸ë¨¼íŠ¸ê°€ ì–´ë””ë¡œë¶€í„° ì°¸ì¡°ë˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ê·¸ê²ƒì€ ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•Šì„ ê²ƒì´ë¼ê³  ì¶”ì¸¡í•  ìˆ˜ ìˆë‹¤.

Scavenge, ì´ê²ƒì€ ë¹ ë¥´ë‚˜ ë¶ˆì™„ì „í•˜ë‹¤.

Mark-Sweep, ì´ê²ƒì€ ëŠë¦¬ì§€ë§Œ ì°¸ì¡°í•˜ì§€ ì•ŠëŠ” ë°ì´í„°ë¥¼ íšŒìˆ˜í•œë‹¤.

### ğŸ Remark 

stackì—ì„œ heapì— ìˆëŠ” ê¸°ì¡´ì˜ ê°’ìœ¼ë¡œ ë³€ê²½í•˜ëŠ” ìƒí™©ì—ì„œ
stack í¬ì¸í„°ëŠ” ë³€ê²½í•˜ë ¤ê³  í•  ë•Œ, ë³€ê²½í•˜ë ¤ê³  í•˜ëŠ” ê°’ì´ ë“¤ì–´ ìˆëŠ” ê¸°ì¡´ì˜ heap ì£¼ì†Œë¥¼ ê°€ë¦¬í‚¤ê²Œ ë©ë‹ˆë‹¤.

@spread ì—°ì‚°ìë¥¼ ì“°ë©´ì„œ ë¶ˆë³€ì„±ì„ ìœ ì§€í•˜ë©´ forEachë¥¼ ë°”ê¾¸ë©´ ë©ë‹ˆë‹¤.

allocation(ë§¤ëª¨ë¦¬ í• ë‹¹)ë¥¼ ë”°ë¡œ êµ¬í˜„í•´ì„œ ë§Œë“¤ë©´ ë©ë‹ˆë‹¤.

utils.js í™•ì¸í•´ë³´ê¸°

Ex) import {handleErr, toHexString} from "./utils.js";

[].map().join() ìœ¼ë¡œ í•˜ë©´ joinì•ˆ ë³€ìˆ˜ë¥¼ ì‚¬ì´ì‚¬ì´ ë„£ì–´ì¤ë‹ˆë‹¤.

ì»¨ë²¤ì…˜ í™•ì¸í•˜ê¸°

> nodejs ê´€ë ¨ ë§í¬

Pointers and dynamic memory - stack vs heap ì˜ìƒ :

https://www.youtube.com/watch?v=_8-ht2AKyH4&list=LL&index=5&t=11s

V8 ì—”ì§„(ìë°”ìŠ¤í¬ë¦½íŠ¸, NodeJS, Deno, WebAssembly) ë‚´ë¶€ì˜ ë©”ëª¨ë¦¬ ê´€ë¦¬ ì‹œê°í™”í•˜ê¸° :

https://ui.toast.com/weekly-pick/ko_20200228

JavaScript ë¥¼ í†µí•´ Binary Data ì¡°ì‘í•˜ê¸° :

http://mohwa.github.io/blog/javascript/2015/08/31/binary-inJS/

node.js memory leak ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ :

https://dongmin-jang.medium.com/node-js-memory-leak-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EB%88%84%EC%88%98-ac32234cb9e0
